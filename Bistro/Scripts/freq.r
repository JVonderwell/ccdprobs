## R code to compare the frequency of trees
## to mrbayes

## question: do w divide by length(w) to get std error? not indep sample.

## primates --------------------------------------------------
library(ape)
dat <- read.table("run2.txt", header=TRUE)
str(dat)
logweight = dat$logWt
logw = logweight - max(logweight)
w = exp(logw) / sum(exp(logw))
dat$w <- w

ess = 1/sum(w^2)
ess
ess/length(w) ## 53.37%

means=with(dat, sapply( split( w,tree ),sum ) )
means
## (1,(2,12),(((((3,4),5),6),7),(((8,9),10),11)));
##                                    4.723935e-25
## (1,2,((((((3,4),5),6),(((8,9),10),11)),7),12));
##                                    1.290444e-21
## (1,2,((((((3,4),5),6),7),(((8,10),9),11)),12));
##                                    5.397824e-18
## (1,2,((((((3,4),5),6),7),(((8,9),10),11)),12));
##                                    9.999065e-01
## (1,2,((((((3,4),5),6),7),((8,9),(10,11))),12));
##                                    1.586965e-10
## (1,2,((((((3,4),5),6),7),12),(((8,9),10),11)));
##                                    7.208545e-09
## (1,2,((((((3,4),5),6),7),12),((8,9),(10,11))));
##                                    1.369638e-18
## (1,2,((((((3,4),5),7),6),(((8,9),10),11)),12));
##                                    2.148390e-08
## (1,2,((((((3,4),5),7),6),((8,9),(10,11))),12));
##                                    1.239300e-18
## (1,2,((((((3,4),5),7),6),12),(((8,9),10),11)));
##                                    3.569659e-17
## (1,2,((((((3,5),4),6),7),(((8,9),10),11)),12));
##                                    3.912789e-08
## (1,2,((((((3,5),4),6),7),((8,9),(10,11))),12));
##                                    1.812700e-17
## (1,2,((((((3,5),4),6),7),12),(((8,9),10),11)));
##                                    1.136021e-16
## (1,2,((((((3,5),4),7),6),(((8,9),10),11)),12));
##                                    9.147309e-16
## (1,2,(((((3,(4,5)),6),7),(((8,10),9),11)),12));
##                                    1.963811e-22
## (1,2,(((((3,(4,5)),6),7),(((8,9),10),11)),12));
##                                    9.346465e-05
## (1,2,(((((3,(4,5)),6),7),((8,9),(10,11))),12));
##                                    1.807615e-14
## (1,2,(((((3,(4,5)),6),7),12),(((8,9),10),11)));
##                                    2.200193e-13
## (1,2,(((((3,(4,5)),6),7),12),((8,9),(10,11))));
##                                    4.034518e-22
## (1,2,(((((3,(4,5)),7),6),(((8,9),10),11)),12));
##                                    1.016781e-12
## (1,2,(((((3,(4,5)),7),6),12),(((8,9),10),11)));
##                                    1.233329e-20
## (1,2,(((((3,4),5),(6,7)),(((8,9),10),11)),12));
##                                    5.675361e-10
## (1,2,(((((3,4),5),(6,7)),((8,9),(10,11))),12));
##                                    6.960830e-20
## (1,2,(((((3,4),5),(6,7)),12),(((8,9),10),11)));
##                                    8.711309e-18
## (1,2,(((((3,4),5),6),(7,(((8,9),10),11))),12));
##                                    4.548906e-22
## (1,2,(((((3,4),5),6),(7,12)),(((8,9),10),11)));
##                                    8.007651e-28
## (1,2,(((((3,4),5),6),7),((((8,9),10),11),12)));
##                                    8.801519e-12
## (1,2,(((((3,4),5),7),6),(((8,9),(10,11)),12)));
##                                    2.049944e-27
## (1,2,(((((3,5),4),(6,7)),(((8,9),10),11)),12));
##                                    9.919936e-18
## (1,2,((((3,(4,5)),(6,7)),(((8,9),10),11)),12));
##                                    1.899511e-14
## (1,2,((((3,(4,5)),6),7),((((8,9),10),11),12)));
##                                    1.061983e-15

means[4]
## (1,2,((((((3,4),5),6),7),(((8,9),10),11)),12));
##                                    9.999065e-01
means[16]
## (1,2,(((((3,(4,5)),6),7),(((8,9),10),11)),12));
##                                    9.346465e-05


## in mrbayes:
##   tree tree_1 [p = 0.995, P = 0.995] = [&W 0.995303] (2,(12,((11,(10,(9,8))),(7,(6,(5,(4,3)))))),1);
##   tree tree_2 [p = 0.005, P = 1.000] = [&W 0.004636] (2,(12,((11,(10,(9,8))),(7,(6,((5,4),3))))),1);


dat$mean1 = means[4]
dat$mean2 = means[16]
head(dat)
dat$indicator1 = dat$tree == levels(dat$tree)[4]
dat$indicator2 = dat$tree == levels(dat$tree)[16]
v1 = sum(dat$w*(dat$indicator1 - dat$mean1)^2)
v2 = sum(dat$w*(dat$indicator2 - dat$mean2)^2)
sqrt(v1/length(w)) ## 0.0001368
sqrt(v2/length(w)) ## 0.0001367


## artiodactyl----------------------------------------------------
library(ape)
dat <- read.table("run16.txt", header=TRUE)
str(dat)
logweight = dat$logWt
logw = logweight - max(logweight)
w = exp(logw) / sum(exp(logw))
dat$w <- w

ess = 1/sum(w^2)
ess
ess/length(w) ## 34.54% (artiodactyl)

means=with(dat, sapply( split( w,tree ),sum ) )
means
## (1,((2,3),(5,6)),4); (1,((2,3),5),(4,6)); (1,((2,5),(4,6)),3);
##         2.498735e-24         5.635129e-28         1.734376e-26
## (1,(2,((4,5),6)),3); (1,(2,((4,6),5)),3); (1,(2,(4,(5,6))),3);
##         2.093593e-10         2.651260e-04         5.899925e-03
## (1,(2,3),((4,5),6)); (1,(2,3),((4,6),5)); (1,(2,3),(4,(5,6)));
##         8.910928e-10         5.682623e-05         1.367697e-02
## (1,2,((3,(5,6)),4)); (1,2,(3,((4,5),6))); (1,2,(3,((4,6),5)));
##         8.127873e-23         1.933638e-06         3.471426e-01
## (1,2,(3,(4,(5,6))));
##         6.329566e-01

means[13] ## 1st tree: 0.63296 (1,2,(3,(4,(5,6))));
means[12] ## 2nd tree: 0.34714 (1,2,(3,((4,6),5)));

## in mrbayes:
## tree tree_1 [p = 0.493, P = 0.493] = [&W 0.493485] (2,(((6,5),4),3),1);
## tree tree_2 [p = 0.474, P = 0.967] = [&W 0.473759] (2,((5,(6,4)),3),1);

dat$mean1 = means[13]
dat$mean2 = means[12]
head(dat)
dat$indicator1 = dat$tree == levels(dat$tree)[13]
dat$indicator2 = dat$tree == levels(dat$tree)[12]
v1 = sum(dat$w*(dat$indicator1 - dat$mean1)^2)
v2 = sum(dat$w*(dat$indicator2 - dat$mean2)^2)
sqrt(v1/length(w)) ## 0.0068165
sqrt(v2/length(w)) ## 0.006733



